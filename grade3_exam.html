<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å¹´çº§æœŸæœ«å¤§å†²åˆº - åŠ©åŠ›å®è´æ‹¿é«˜åˆ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #FF8A80;
            --secondary-color: #FFD54F;
            --success-color: #81C784;
            --bg-color: #FFF9F0;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'PingFang SC', 'zcool-gdt', system-ui, -apple-system, sans-serif;
            color: #4E342E;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, #FFAB91, #FF7043);
            color: white;
            padding: 2.5rem 0;
            text-align: center;
            border-bottom-left-radius: 60px;
            border-bottom-right-radius: 60px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.3);
        }

        .nav-pills .nav-link {
            border-radius: 30px;
            padding: 12px 25px;
            font-weight: 600;
            color: #795548;
            transition: all 0.3s;
            background: white;
            margin: 5px;
            box-shadow: var(--card-shadow);
        }

        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .module-card {
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 1.8rem;
            color: #D84315;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .word-block {
            background: #FFF3E0;
            padding: 10px 18px;
            border-radius: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            user-select: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .word-block:hover {
            border-color: var(--primary-color);
            background: #FFE0B2;
        }

        .composition-card {
            border-left: 8px solid #FF7043;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .poetry-card {
            background: #E8F5E9;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            height: 100%;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .poetry-card:hover {
            transform: translateY(-5px);
        }

        .poetry-title {
            font-weight: bold;
            color: #2E7D32;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .score-badge {
            background: #FFD54F;
            color: #F57C00;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .maruko-mascot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }

        .maruko-mascot:hover { transform: scale(1.1) rotate(-5deg); }

        .translation-option {
            border: 2px solid #FFE0B2;
            border-radius: 15px;
            padding: 12px;
            transition: all 0.2s;
            cursor: pointer;
            text-align: center;
        }

        .translation-option:hover {
            background-color: #FFF3E0;
            border-color: var(--primary-color);
        }

        .phonics-card {
            background: #F3E5F5;
            border-radius: 20px;
            padding: 15px;
            border: 2px solid #E1BEE7;
            transition: all 0.3s;
        }

        .phonics-letter {
            font-size: 2rem;
            color: #7B1FA2;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .phonics-sound {
            color: #9C27B0;
            font-style: italic;
            display: block;
            margin-bottom: 10px;
        }

        .phonics-word-item {
            background: white;
            border-radius: 12px;
            padding: 8px 12px;
            margin: 4px;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.95rem;
        }

        .phonics-word-item:hover {
            transform: scale(1.1);
            background: #EDE7F6;
        }

        .min-vh-10 { min-height: 80px; }
    </style>
</head>
<body>

<div class="header">
    <div class="container">
        <h1 class="display-4 fw-bold animate__animated animate__bounceIn">ğŸ’ ä¸‰å¹´çº§æœŸæœ«å¤‡è€ƒç‰¹è®­</h1>
        <p class="lead">è‹±è¯­ã€è¯­æ–‡ã€å¤è¯—ï¼Œå…¨ç§‘é€šå…³ï¼âœ¨</p>
        <div class="mt-3">
            <button class="btn btn-light rounded-pill px-4 shadow-sm" onclick="unlockAudio()">
                ğŸ”Š å¼€å¯å­¦ä¹ é…éŸ³
            </button>
        </div>
    </div>
</div>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="score-badge shadow-sm">â­ å­¦ä¹ èƒ½é‡: <span id="user-score">0</span></div>
        <div class="fw-bold text-danger">ğŸ‘§ å®è´æœ€æ£’ï¼Œè€ƒè¯•åŠ æ²¹ï¼</div>
    </div>

    <ul class="nav nav-pills mb-4 justify-content-center sticky-top bg-transparent p-2" id="mainTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#english-zone">ğŸ”¤ è‹±è¯­å£è¯­</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#phonics-zone">ğŸ—£ï¸ è¯­éŸ³è¾¾äºº</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#chinese-zone">âœï¸ è¯­æ–‡ä½œæ–‡</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#poetry-zone">ğŸ® å¿…èƒŒå¤è¯—</button></li>
    </ul>

    <div class="tab-content">
        <!-- è‹±è¯­æ¿å— -->
        <div class="tab-pane fade show active" id="english-zone">
            <div class="row justify-content-center">
                <div class="col-md-9">
                    <div class="module-card text-center animate__animated animate__fadeIn">
                        <div id="english-game-start">
                            <h3 class="mb-4">ğŸ¤ ä¸‰ä¸ŠæœŸæœ«å£è¯­ Q&A ç»ƒä¹  (28é¢˜)</h3>
                            <p class="text-muted mb-4">å…¨é¢è¦†ç›–æœŸæœ«å¿…è€ƒå¯¹è¯ï¼Œæ‹¼å›¾æŒ‘æˆ˜ï¼ŒåŠ æ·±è®°å¿†ï¼</p>
                            <button class="btn btn-primary btn-lg rounded-pill px-5" onclick="startEnglishChallenge()">å¼€å¯é—¯å…³</button>
                        </div>
                        <div id="english-game-play" style="display:none;">
                            <div class="progress mb-4" style="height: 10px; border-radius: 10px;">
                                <div id="english-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                            </div>
                            <div class="question-text" id="current-question">Question?</div>
                            
                            <div id="translation-phase" class="mb-4">
                                <p class="fw-bold text-muted small mb-3">è¿™å¥è¯çš„æ„æ€æ˜¯ï¼š</p>
                                <div id="translation-options" class="d-grid gap-2"></div>
                            </div>

                            <div id="puzzle-phase" style="display:none;">
                                <div id="answer-display" class="p-3 border rounded-4 bg-light min-vh-10 mb-3 text-start d-flex flex-wrap gap-2 align-items-center">
                                    <p class="text-muted small m-0">è¯·æŒ‰é¡ºåºç‚¹å‡»å•è¯æ‹¼å‡ºç­”æ¡ˆ...</p>
                                </div>
                                <div id="word-pool" class="d-flex flex-wrap justify-content-center gap-2"></div>
                            </div>

                            <div class="mt-4" id="english-controls">
                                <button class="btn btn-info rounded-pill text-white px-4" onclick="hearQuestion()">ğŸ”Š å¬é—®é¢˜</button>
                                <button class="btn btn-warning rounded-pill text-white px-4" onclick="showHint()">ğŸ’¡ æç¤º</button>
                            </div>

                            <div id="english-result" class="mt-4 animate__animated" style="display:none;">
                                <h4 class="text-success fw-bold">å¤ªæ£’äº†ï¼æ‹¼å¯¹å•¦ï¼ğŸ‰</h4>
                                <p class="text-muted">è·Ÿæˆ‘è¯»ä¸€éï¼š</p>
                                <h3 id="correct-answer" class="text-primary p-3 bg-light rounded-4 border">Answer</h3>
                                <button class="btn btn-success rounded-pill px-5 mt-3" onclick="nextEnglishQuestion()">ä¸‹ä¸€é¢˜ âœ…</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯­éŸ³è¾¾äººæ¿å— -->
        <div class="tab-pane fade" id="phonics-zone">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="module-card">
                        <h3 class="mb-4 text-center">ğŸ—£ï¸ ä¸‰ä¸Š Phonics è¯­éŸ³é—¯å…³</h3>
                        <p class="text-muted text-center mb-4">è§‚å¯Ÿå•è¯ç»“æ„ï¼Œç»ƒä¹ è‡ªç„¶æ‹¼è¯»ï¼ŒæŒæ¡å­—æ¯å‘éŸ³è§„å¾‹ï¼</p>
                        <div id="phonics-container" class="row g-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯­æ–‡æ¿å— -->
        <div class="tab-pane fade" id="chinese-zone">
            <div class="row">
                <div class="col-md-12">
                    <div class="module-card">
                        <h3 class="mb-4">âœï¸ è¯­æ–‡ 1-8 å•å…ƒåŒæ­¥ä½œæ–‡èŒƒæ–‡</h3>
                        <p class="text-muted mb-4">ç²¾é€‰æœŸæœ«å¸¸è€ƒé¢˜ç›®ï¼Œæ”¯æŒå…¨æ–‡æœ—è¯»ï¼Œå­¦ä¹ ä¼˜ç¾å¥å¼ã€‚</p>
                        <div class="row g-3" id="composition-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¤è¯—æ¿å— -->
        <div class="tab-pane fade" id="poetry-zone">
            <div class="row">
                <div class="col-md-12">
                    <div class="module-card">
                        <h3 class="mb-4">ğŸ® å°å­¦ç”Ÿè¯¾æ ‡å¿…èƒŒå¤è¯—è¯ (ç²¾é€‰)</h3>
                        <p class="text-muted mb-4">ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹å…¨æ–‡å¹¶å¬æœ—è¯»ï¼ŒæŒ‘æˆ˜èƒŒè¯µå§ï¼</p>
                        <div class="row g-3" id="poetry-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="maruko-mascot animate__animated animate__bounceIn" onclick="marukoTalk()">
    <img src="https://img.icons8.com/color/96/anime.png" alt="Maruko">
</div>

<audio id="sfx-correct" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- å®Œæ•´è‹±è¯­ Q&A æ•°æ® (28é¢˜) ---
    const englishQuestions = [
        {q: "Good morning.", a: "Good morning.", cn: "æ—©ä¸Šå¥½ã€‚"},
        {q: "What's your name?", a: "My name is Lily.", cn: "ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ"},
        {q: "How old are you?", a: "I'm nine years old.", cn: "ä½ å‡ å²äº†ï¼Ÿ"},
        {q: "Nice to meet you.", a: "Nice to meet you too.", cn: "å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚"},
        {q: "Do you have a pet?", a: "Yes, I do.", cn: "ä½ æœ‰å® ç‰©å—ï¼Ÿ"},
        {q: "What color is it?", a: "It is red.", cn: "å®ƒæ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ"},
        {q: "Let's go to the zoo.", a: "Great idea.", cn: "æˆ‘ä»¬å»åŠ¨ç‰©å›­å§ã€‚"},
        {q: "How many apples do you have?", a: "I have five apples.", cn: "ä½ æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ"},
        {q: "Happy birthday!", a: "Thank you!", cn: "ç”Ÿæ—¥å¿«ä¹ï¼"},
        {q: "What do plants need?", a: "Plants need water and sun.", cn: "æ¤ç‰©éœ€è¦ä»€ä¹ˆï¼Ÿ"},
        {q: "What color is your dog?", a: "It is black and white.", cn: "ä½ çš„ç‹—æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ"},
        {q: "Is this your photo?", a: "Yes, it is.", cn: "è¿™æ˜¯ä½ çš„ç…§ç‰‡å—ï¼Ÿ"},
        {q: "What colours make green?", a: "Blue and yellow make green.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç»¿è‰²ï¼Ÿ"},
        {q: "What colours do you like?", a: "I like red and pink.", cn: "ä½ å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ"},
        {q: "Do you have a big family?", a: "Yes, I do.", cn: "ä½ æœ‰ä¸€ä¸ªå¤§å®¶åº­å—ï¼Ÿ"},
        {q: "What can plants give us?", a: "Plants can give us fresh air.", cn: "æ¤ç‰©èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼Ÿ"},
        {q: "Are you a good friend?", a: "Yes, I am. I help others.", cn: "ä½ æ˜¯ä¸€ä¸ªå¥½æœ‹å‹å—ï¼Ÿ"},
        {q: "What's that?", a: "It's a tiger.", cn: "é‚£æ˜¯ä»€ä¹ˆï¼Ÿ"},
        {q: "How many tigers do you see?", a: "I see three tigers.", cn: "ä½ çœ‹åˆ°äº†å‡ åªè€è™ï¼Ÿ"},
        {q: "What colours make purple?", a: "Red and blue make purple.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç´«è‰²ï¼Ÿ"},
        {q: "What colours make orange?", a: "Red and yellow make orange.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆæ©™è‰²ï¼Ÿ"},
        {q: "What colours make pink?", a: "Red and white make pink.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç²‰è‰²ï¼Ÿ"},
        {q: "What colours make gray?", a: "Black and white make gray.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç°è‰²ï¼Ÿ"},
        {q: "Your dog is very cute!", a: "Thank you!", cn: "ä½ çš„ç‹—çœŸå¯çˆ±ï¼"},
        {q: "We can share.", a: "Thank you.", cn: "æˆ‘ä»¬å¯ä»¥åˆ†äº«ã€‚"},
        {q: "Is that your brother?", a: "No, it isn't.", cn: "é‚£æ˜¯ä½ å¼Ÿå¼Ÿå—ï¼Ÿ"},
        {q: "What do friends do?", a: "Friends help and share.", cn: "æœ‹å‹ä¹‹é—´ä¼šåšä»€ä¹ˆï¼Ÿ"},
        {q: "What colour is the grass?", a: "It is green.", cn: "è‰æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ"}
    ];

    const compositions = [
        {
            title: "ç¬¬å…«å•å…ƒã€Šé‚£æ¬¡ç»å†çœŸéš¾å¿˜ã€‹- å †é›ªäºº",
            content: "å»å¹´å†¬å¤©çš„ä¸€ä¸ªå‘¨æœ«ï¼Œæˆ‘å’Œçˆ¸çˆ¸å¦ˆå¦ˆå»å…¬å›­å †é›ªäººã€‚é‚£å¤©çš„å¿«ä¹åƒé›ªçƒä¸€æ ·ï¼Œè¶Šæ»šè¶Šå¤§ã€‚é›ªèŠ±åƒæ£‰èŠ±ç³–ä¸€æ ·è½¯è½¯çš„ï¼Œè¸©ä¸Šå»â€œå’¯å±å’¯å±â€å“ã€‚çˆ¸çˆ¸å›¢äº†ä¸ªå°é›ªçƒï¼Œæˆ‘å¼¯ç€è…°ä½¿åŠ²æ¨ï¼Œé›ªçƒè¶Šæ»šè¶Šå¤§ï¼Œå˜æˆäº†é›ªäººçš„â€œå¤§è‚šå­â€ã€‚å¦ˆå¦ˆæ‰¾æ¥æ ‘æå½“èƒ³è†Šï¼Œæˆ‘æŒ‰ä¸Šçº½æ‰£å½“çœ¼ç›ï¼Œçˆ¸çˆ¸æ’ä¸Šèƒ¡èåœå½“é¼»å­ã€‚æˆ‘ä»¬è¿˜åœ¨é›ªåœ°é‡Œæ‰“é›ªä»—ï¼Œç¬‘å£°æ¯”åŒ—é£è¿˜å“äº®ã€‚é‚£æ¬¡ç»å†åƒå°å¤ªé˜³ï¼Œæš–æ´‹æ´‹çš„ç•™åœ¨å¿ƒé‡Œã€‚"
        },
        {
            title: "ç¬¬å…«å•å…ƒã€Šé‚£æ¬¡ç»å†çœŸéš¾å¿˜ã€‹- ç¬¬ä¸€æ¬¡è®²æ•…äº‹",
            content: "ç­ä¼šè¯¾ä¸Šï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä¸Šå°è®²æ•…äº‹ã€‚æˆ‘å¿ƒé‡Œæ€¦æ€¦ç›´è·³ï¼Œè…¿éƒ½æœ‰ç‚¹å‘è½¯ã€‚ä½†æˆ‘å’¬å’¬ç‰™ï¼Œä¸¾èµ·äº†æ‰‹ã€‚è½®åˆ°æˆ‘æ—¶ï¼Œæˆ‘æ”¥ç€æ•…äº‹ä¹¦æ…¢æ…¢èµ°ä¸Šè®²å°ã€‚åˆšå¼€å§‹å£°éŸ³æŠ–å¾—åƒé£ä¸­çš„æ ‘å¶ï¼Œä½†çœ‹åˆ°è€å¸ˆé¼“åŠ±çš„çœ¼ç¥ï¼Œæˆ‘é‡æ–°å®šäº†å®šç¥ã€‚æˆ‘è®²å¾—ç»˜å£°ç»˜è‰²ï¼Œè®²å®Œåæ•™å®¤é‡Œå“èµ·äº†æŒå£°ã€‚è€å¸ˆå¤¸æˆ‘è®²å¾—æ¯”å½•éŸ³è¿˜å¥½å¬å‘¢ï¼åŸæ¥å‹‡æ•¢è¯•ä¸€è¯•ï¼Œå°±èƒ½æ”¶è·è¿™ä¹ˆå¤šå¿«ä¹ã€‚"
        },
        {
            title: "ç¬¬å…«å•å…ƒã€Šé‚£æ¬¡ç»å†çœŸéš¾å¿˜ã€‹- ç§å‘æ—¥è‘µ",
            content: "å»å¹´æ˜¥å¤©ï¼Œæˆ‘åœ¨èŠ±å›é‡Œç§ä¸‹äº†ä¸€é¢—å‘æ—¥è‘µç§å­ã€‚å®ƒå°å°çš„ã€æ‰æ‰çš„ï¼Œæˆ‘å°å¿ƒåœ°æŠŠå®ƒç§è¿›åœŸé‡Œã€‚æ¯å¤©æ”¾å­¦æˆ‘éƒ½å»æµ‡æ°´ã€‚ä¸‰å¤©åï¼ŒåœŸé‡Œå†’å‡ºäº†å«©èŠ½ï¼Œåƒä¸ªå®³ç¾çš„å°å§‘å¨˜ã€‚æ…¢æ…¢åœ°ï¼Œå®ƒé•¿å‡ºäº†åœ†å¶å­ï¼Œå¼€å‡ºäº†é‡‘é»„è‰²çš„èŠ±ç“£ã€‚çœ‹ç€å‘æ—¥è‘µæœç€å¤ªé˜³ç‚¹å¤´ï¼Œæˆ‘å¿ƒé‡Œç”œæ»‹æ»‹çš„ã€‚è¿™æ¬¡ç»å†è®©æˆ‘æ˜ç™½ï¼Œåªè¦ç”¨å¿ƒç…§é¡¾ï¼Œä»˜å‡ºå°±ä¼šæœ‰ç¾ä¸½çš„æƒŠå–œã€‚"
        }
    ];

    const poems = [
        {title: "å’é¹…", author: "éª†å®¾ç‹", content: "é¹…ï¼Œé¹…ï¼Œé¹…ï¼Œæ›²é¡¹å‘å¤©æ­Œã€‚ç™½æ¯›æµ®ç»¿æ°´ï¼Œçº¢æŒæ‹¨æ¸…æ³¢ã€‚"},
        {title: "é™å¤œæ€", author: "æç™½", content: "åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚"},
        {title: "æ˜¥æ™“", author: "å­Ÿæµ©ç„¶", content: "æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿã€‚å¤œæ¥é£é›¨å£°ï¼ŒèŠ±è½çŸ¥å¤šå°‘ã€‚"},
        {title: "æ‚¯å†œ", author: "æç»…", content: "é”„ç¦¾æ—¥å½“åˆï¼Œæ±—æ»´ç¦¾ä¸‹åœŸã€‚è°çŸ¥ç›˜ä¸­é¤ï¼Œç²’ç²’çš†è¾›è‹¦ã€‚"},
        {title: "æ±Ÿé›ª", author: "æŸ³å®—å…ƒ", content: "åƒå±±é¸Ÿé£ç»ï¼Œä¸‡å¾„äººè¸ªç­ã€‚å­¤èˆŸè“‘ç¬ ç¿ï¼Œç‹¬é’“å¯’æ±Ÿé›ªã€‚"},
        {title: "å±±è¡Œ", author: "æœç‰§", content: "è¿œä¸Šå¯’å±±çŸ³å¾„æ–œï¼Œç™½äº‘æ·±å¤„æœ‰äººå®¶ã€‚åœè½¦åçˆ±æ«æ—æ™šï¼Œéœœå¶çº¢äºäºŒæœˆèŠ±ã€‚"},
        {title: "æœ›åºå±±ç€‘å¸ƒ", author: "æç™½", content: "æ—¥ç…§é¦™ç‚‰ç”Ÿç´«çƒŸï¼Œé¥çœ‹ç€‘å¸ƒæŒ‚å‰å·ã€‚é£æµç›´ä¸‹ä¸‰åƒå°ºï¼Œç–‘æ˜¯é“¶æ²³è½ä¹å¤©ã€‚"},
        {title: "èµ æ±ªä¼¦", author: "æç™½", content: "æç™½ä¹˜èˆŸå°†æ¬²è¡Œï¼Œå¿½é—»å²¸ä¸Šè¸æ­Œå£°ã€‚æ¡ƒèŠ±æ½­æ°´æ·±åƒå°ºï¼Œä¸åŠæ±ªä¼¦é€æˆ‘æƒ…ã€‚"},
        {title: "å›ä¹¡å¶ä¹¦", author: "è´ºçŸ¥ç« ", content: "å°‘å°ç¦»å®¶è€å¤§å›ï¼Œä¹¡éŸ³æ— æ”¹é¬“æ¯›è¡°ã€‚å„¿ç«¥ç›¸è§ä¸ç›¸è¯†ï¼Œç¬‘é—®å®¢ä»ä½•å¤„æ¥ã€‚"}
    ];

    let state = {
        score: parseInt(localStorage.getItem('grade3_exam_score')) || 0,
        englishIndex: 0,
        puzzleOrder: [],
        unlocked: false
    };

    // --- è¯­éŸ³é€»è¾‘ (Phonics) ---
    const phonicsData = [
        { letter: "Aa", sound: "/ Ã¦ /", words: ["bag", "can", "and", "cat", "bad", "dad", "cab", "mad", "apple", "sad", "ant", "rat", "hat", "bat", "cap", "rabbit", "have", "hand", "van", "jam", "map", "nap", "fan", "ham"] },
        { letter: "Bb", sound: "/ b /", words: ["bed", "bag", "Bob", "cab", "big", "boy", "buy", "banana", "baby", "bear", "black", "blue", "back", "bread", "brown", "but"] },
        { letter: "Cc", sound: "/ k /", words: ["cat", "cut", "can", "cab", "cup", "cake", "cute", "colour", "close", "clean", "class", "computer", "cap", "car", "card", "come"] },
        { letter: "Dd", sound: "/ d /", words: ["dog", "bad", "dad", "sad", "dark", "day", "desk", "doll", "duck", "deer", "deep", "mud", "door", "down", "dance", "dinner"] },
        { letter: "Ee", sound: "/ e /", words: ["egg", "pet", "leg", "web", "set", "elephant", "desk", "yellow", "member", "bed", "nest", "pen", "red", "seven", "ten", "men", "bell", "end", "vet", "wet", "fed", "hen", "help", "jet"] },
        { letter: "Ff", sound: "/ f /", words: ["fish", "for", "from", "fire", "floor", "fruit", "five", "beef", "four", "fast", "fly", "fox", "friend", "family", "far", "food", "frog", "foot", "flower", "find", "farm", "funny", "fat", "fear"] },
        { letter: "Gg", sound: "/ g /", words: ["go", "gift", "bug", "grass", "glad", "pig", "girl", "flag", "tag", "frog", "glass", "grape", "green", "grow", "give", "game", "tiger", "guess", "get", "leg"] },
        { letter: "Hh", sound: "/ h /", words: ["hot", "help", "hit", "hear", "her", "his", "hat", "head", "hand", "have", "how", "home", "hope", "happy", "house", "hair"] },
        { letter: "Ii", sound: "/ Éª /", words: ["ill", "kid", "big", "dig", "sit", "six", "fix", "pig", "pin", "lip", "sip", "hit", "fit", "win", "fin", "bin", "pick", "little", "city", "window"] },
        { letter: "Jj", sound: "/ dÊ’ /", words: ["job", "Jim", "joy", "jet", "jam", "juice", "June", "July", "jog", "jump", "jungle", "jacket"] },
        { letter: "Kk", sound: "/ k /", words: ["Kim", "kite", "kid", "key", "kind", "keep", "kick", "kitchen", "cook", "milk", "drink", "look", "book", "dark", "park", "talk", "work", "mask", "risk", "bank"] },
        { letter: "Ll", sound: "/ l /", words: ["leg", "lion", "lab", "link", "like", "love", "listen", "light", "little", "plant", "late", "long", "lamp", "lamb", "yellow", "let"] },
        { letter: "Mm", sound: "/ m /", words: ["map", "mother", "mouse", "money", "mud", "men", "my", "maths", "mouth", "mum", "make", "monkey", "meet", "summer", "member", "Monday", "March", "me", "Miss", "Mr"] },
        { letter: "Nn", sound: "/ n /", words: ["new", "pan", "need", "nose", "noodles", "not", "nap", "nine", "nice", "nurse", "fan", "no", "name", "night", "near", "now", "never", "net", "noon"] },
        { letter: "Oo", sound: "/ É’ /", words: ["box", "dot", "body", "lock", "orange", "job", "log", "shop", "sock", "hop", "cop", "top", "pot", "hot", "frog", "fog", "drop", "fox", "mop", "on"] },
        { letter: "Pp", sound: "/ p /", words: ["cup", "pen", "pink", "pet", "plant", "sleep", "help", "party", "people", "parent", "pretty", "paint", "pig", "pan", "purple", "panda", "plane", "park", "hope", "piano", "happy", "peel", "polite", "put"] },
        { letter: "Qq", sound: "/ kw /", words: ["quit", "quiet", "queen", "quick", "question", "quilt", "quiz", "quarter"] },
        { letter: "Rr", sound: "/ r /", words: ["red", "ride", "from", "friend", "fresh", "fruit", "ruler", "race", "rock", "rat", "rest", "rude", "robot", "run", "read", "rabbit"] },
        { letter: "Ss", sound: "/ s /", words: ["see", "say", "small", "some", "sister", "so", "set", "sea", "sun", "six", "school", "grass", "bus", "seven", "study", "goose"] },
        { letter: "Tt", sound: "/ t /", words: ["Ted", "sit", "tall", "talk", "vet", "tea", "mat", "hat", "taste", "table", "tap", "tiger", "hit", "nut", "cut", "tub", "cat", "hot", "shirt", "eat"] },
        { letter: "Uu", sound: "/ ÊŒ /", words: ["run", "up", "cut", "nut", "fun", "mud", "mug", "cup", "jump", "lucky", "sun", "bus", "uncle", "gum", "duck", "tub", "bug", "us", "plus", "hug"] },
        { letter: "Vv", sound: "/ v /", words: ["van", "vet", "vat", "vest", "very", "visit", "vacation", "five", "give", "live", "drive", "over", "wave", "love", "river", "vegetable"] },
        { letter: "Ww", sound: "/ w /", words: ["we", "win", "won", "with", "swim", "well", "wig", "will", "want", "week", "west", "wall", "wave", "wait", "walk", "warm", "water", "wind", "wood", "window"] },
        { letter: "Xx", sound: "/ ks /", words: ["box", "six", "fix", "tax", "taxi", "fox", "mix", "sex"] },
        { letter: "Yy", sound: "/ j /", words: ["yum", "yo-yo", "yellow", "yes", "year", "yell", "you", "yard", "young", "yeah", "your"] },
        { letter: "Zz", sound: "/ z /", words: ["Zip", "zero", "zig", "zebra", "zoo", "size", "lazy", "zone"] }
    ];

    function loadPhonics() {
        const container = document.getElementById('phonics-container');
        phonicsData.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'col-md-6 col-lg-4';
            card.innerHTML = `
                <div class="phonics-card animate__animated animate__fadeInUp" style="animation-delay: ${i*0.1}s">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <span class="phonics-letter">${item.letter}</span>
                            <span class="phonics-sound">${item.sound}</span>
                        </div>
                        <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="playPhonicsSound('${item.letter}', '${item.sound}')">ğŸ”Š å‘éŸ³</button>
                    </div>
                    <div class="phonics-words">
                        ${item.words.map(word => `<span class="phonics-word-item" onclick="speak('${word}')">${word}</span>`).join('')}
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function playPhonicsSound(letter, sound) {
        speak(letter[0], 0.8, () => {
            setTimeout(() => {
                speak(letter[0], 0.6); 
            }, 500);
        });
    }

    // --- é¡µé¢åˆå§‹åŒ– ---
    window.onload = () => {
        updateScore(0);
        loadCompositions();
        loadPoetry();
        loadPhonics();
    };

    function updateScore(pts) {
        state.score += pts;
        document.getElementById('user-score').innerText = state.score;
        localStorage.setItem('grade3_exam_score', state.score);
        if(pts > 0) showFeedback();
    }

    function showFeedback() {
        const pop = document.getElementById('feedback-pop');
        if(!pop) {
            const div = document.createElement('div');
            div.id = 'feedback-pop';
            div.className = 'fixed-top text-center display-1 animate__animated animate__zoomIn';
            div.style.zIndex = '2000';
            div.style.top = '40%';
            document.body.appendChild(div);
        }
        const emojis = ['ğŸ‰', 'â­', 'ğŸˆ', 'âœ¨', 'ğŸ†'];
        const p = document.getElementById('feedback-pop');
        p.innerText = emojis[Math.floor(Math.random()*emojis.length)];
        p.style.display = 'block';
        setTimeout(() => p.style.display = 'none', 1000);
        document.getElementById('sfx-correct').play();
    }

    function unlockAudio() {
        state.unlocked = true;
        speak("åŠ æ²¹åŠ æ²¹ï¼");
        alert("è¯­éŸ³åŠŸèƒ½å·²å¼€å¯ï¼");
    }

    function speak(text, rate = 1.0, callback) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = text.match(/[\u4e00-\u9fa5]/) ? 'zh-CN' : 'en-US';
        utter.rate = rate;
        if(callback) utter.onend = callback;
        window.speechSynthesis.speak(utter);
    }

    // --- è‹±è¯­é€»è¾‘ ---
    function startEnglishChallenge() {
        state.englishIndex = 0;
        document.getElementById('english-game-start').style.display = 'none';
        document.getElementById('english-game-play').style.display = 'block';
        loadEnglishQuestion();
    }

    function loadEnglishQuestion() {
        const q = englishQuestions[state.englishIndex];
        document.getElementById('current-question').innerText = q.q;
        document.getElementById('english-progress').style.width = `${(state.englishIndex / englishQuestions.length) * 100}%`;
        
        const optionsDiv = document.getElementById('translation-options');
        optionsDiv.innerHTML = '';
        const options = [q.cn];
        while(options.length < 4) {
            const randomCn = englishQuestions[Math.floor(Math.random()*englishQuestions.length)].cn;
            if(!options.includes(randomCn)) options.push(randomCn);
        }
        options.sort(() => Math.random() - 0.5).forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'translation-option animate__animated animate__fadeIn';
            btn.innerText = opt;
            btn.onclick = () => checkTranslation(opt, btn);
            optionsDiv.appendChild(btn);
        });

        document.getElementById('translation-phase').style.display = 'block';
        document.getElementById('puzzle-phase').style.display = 'none';
        document.getElementById('english-result').style.display = 'none';
        speak(q.q);
    }

    function checkTranslation(selected, btn) {
        const q = englishQuestions[state.englishIndex];
        if(selected === q.cn) {
            btn.classList.add('bg-success', 'text-white');
            setTimeout(() => {
                document.getElementById('translation-phase').style.display = 'none';
                loadPuzzle();
            }, 600);
        } else {
            btn.classList.add('bg-danger', 'text-white', 'animate__shakeX');
            speak("ä¸å¯¹å“¦ï¼Œå†æƒ³æƒ³");
            setTimeout(() => btn.className = 'translation-option', 1000);
        }
    }

    function loadPuzzle() {
        const q = englishQuestions[state.englishIndex];
        document.getElementById('puzzle-phase').style.display = 'block';
        document.getElementById('answer-display').innerHTML = '<p class="text-muted small m-0">æ‹¼å‡ºè‹±æ–‡å›ç­”...</p>';
        state.puzzleOrder = [];
        
        const words = q.a.split(' ');
        const pool = document.getElementById('word-pool');
        pool.innerHTML = '';
        [...words].sort(() => Math.random() - 0.5).forEach(w => {
            const div = document.createElement('div');
            div.className = 'word-block shadow-sm animate__animated animate__fadeIn';
            div.innerText = w;
            div.onclick = () => selectWord(w, div);
            pool.appendChild(div);
        });
    }

    function selectWord(word, el) {
        if(el.style.visibility === 'hidden') return;
        const q = englishQuestions[state.englishIndex];
        const words = q.a.split(' ');
        if(word === words[state.puzzleOrder.length]) {
            state.puzzleOrder.push(word);
            el.style.visibility = 'hidden';
            const display = document.getElementById('answer-display');
            if(state.puzzleOrder.length === 1) display.innerHTML = '';
            display.innerHTML += `<span class="badge bg-primary p-2 animate__animated animate__bounceIn m-1">${word}</span> `;
            speak(word);
            if(state.puzzleOrder.length === words.length) {
                showSuccess();
            }
        } else {
            el.classList.add('bg-danger', 'text-white', 'animate__shakeX');
            setTimeout(() => el.classList.remove('bg-danger', 'text-white', 'animate__shakeX'), 500);
            speak("ä¸å¯¹å“¦");
        }
    }

    function showSuccess() {
        const q = englishQuestions[state.englishIndex];
        document.getElementById('english-result').style.display = 'block';
        document.getElementById('correct-answer').innerText = q.a;
        speak(q.a, 0.9, () => updateScore(10));
    }

    function nextEnglishQuestion() {
        state.englishIndex++;
        if(state.englishIndex < englishQuestions.length) {
            loadEnglishQuestion();
        } else {
            alert("é€šå…³å•¦ï¼å®è´ä½ æ˜¯æœ€æ£’çš„ï¼ğŸ‘");
            startEnglishChallenge();
        }
    }

    function hearQuestion() {
        speak(englishQuestions[state.englishIndex].q);
    }

    function showHint() {
        alert("æ‚„æ‚„å‘Šè¯‰ä½ ï¼Œç­”æ¡ˆæ˜¯: " + englishQuestions[state.englishIndex].a);
    }

    // --- è¯­æ–‡é€»è¾‘ ---
    function loadCompositions() {
        const list = document.getElementById('composition-list');
        compositions.forEach((c, i) => {
            list.innerHTML += `
                <div class="col-12">
                    <div class="composition-card animate__animated animate__fadeInLeft" style="animation-delay: ${i*0.2}s">
                        <h5 class="fw-bold text-danger mb-3">ğŸ“ ${c.title}</h5>
                        <p>${c.content}</p>
                        <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="speak('${c.content.replace(/'/g, "\\'")}', 0.85)">ğŸ”Š å¬èŒƒæ–‡æœ—è¯»</button>
                    </div>
                </div>
            `;
        });
    }

    // --- å¤è¯—é€»è¾‘ ---
    function loadPoetry() {
        const list = document.getElementById('poetry-list');
        poems.forEach((p, i) => {
            list.innerHTML += `
                <div class="col-6 col-md-4">
                    <div class="poetry-card animate__animated animate__fadeInUp" style="animation-delay: ${i*0.1}s" onclick="showPoetry('${p.title}')">
                        <div class="poetry-title">${p.title}</div>
                        <div class="small text-muted">${p.author}</div>
                    </div>
                </div>
            `;
        });
    }

    function showPoetry(title) {
        const p = poems.find(x => x.title === title);
        alert(`ã€${p.title}ã€‘\n${p.author}\n\n${p.content}`);
        speak(p.content, 0.8);
    }

    function marukoTalk() {
        const lines = ["å®è´ï¼ŒåŠ æ²¹å¤ä¹ å“¦ï¼", "å°ä¸¸å­é™ªç€ä½ ï¼Œè€ƒ 100 åˆ†ï¼", "ä½ æ˜¯æœ€æ£’çš„å°æ‰å¥³ï¼", "è‹±è¯­å’Œè¯­æ–‡éƒ½è¦åŠ æ²¹ï¼"];
        const line = lines[Math.floor(Math.random()*lines.length)];
        speak(line);
        alert("å°ä¸¸å­è¯´ï¼š" + line);
    }
</script>
</body>
</html>
