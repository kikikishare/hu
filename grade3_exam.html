<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å¹´çº§æœŸæœ«å¤§å†²åˆº - åŠ©åŠ›å®è´æ‹¿é«˜åˆ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #FF8A80;
            --secondary-color: #FFD54F;
            --success-color: #81C784;
            --bg-color: #FFF9F0;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'PingFang SC', 'zcool-gdt', system-ui, -apple-system, sans-serif;
            color: #4E342E;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, #FFAB91, #FF7043);
            color: white;
            padding: 2.5rem 0;
            text-align: center;
            border-bottom-left-radius: 60px;
            border-bottom-right-radius: 60px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.3);
        }

        .nav-pills .nav-link {
            border-radius: 30px;
            padding: 12px 25px;
            font-weight: 600;
            color: #795548;
            transition: all 0.3s;
            background: white;
            margin: 5px;
            box-shadow: var(--card-shadow);
        }

        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .module-card {
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 1.8rem;
            color: #D84315;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .word-block {
            background: #FFF3E0;
            padding: 10px 18px;
            border-radius: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            user-select: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .word-block:hover {
            border-color: var(--primary-color);
            background: #FFE0B2;
        }

        .composition-card {
            border-left: 8px solid #FF7043;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .poetry-card {
            background: #E8F5E9;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            height: 100%;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            perspective: 1000px;
            transform-style: preserve-3d;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .poetry-card.is-flipped {
            transform: rotateY(180deg);
            background: #F1F8E9;
        }

        .poetry-front, .poetry-back {
            backface-visibility: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .poetry-back {
            transform: rotateY(180deg);
            position: absolute;
            top: 0;
            left: 0;
            padding: 20px;
        }

        .poetry-content-full {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #1B5E20;
            word-break: break-all;
        }

        .score-badge {
            background: #FFD54F;
            color: #F57C00;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .maruko-mascot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }

        .maruko-mascot:hover { transform: scale(1.1) rotate(-5deg); }

        .translation-option {
            border: 2px solid #FFE0B2;
            border-radius: 15px;
            padding: 12px;
            transition: all 0.2s;
            cursor: pointer;
            text-align: center;
        }

        .translation-option:hover {
            background-color: #FFF3E0;
            border-color: var(--primary-color);
        }

        .phonics-card {
            background: #F3E5F5;
            border-radius: 20px;
            padding: 15px;
            border: 2px solid #E1BEE7;
            transition: all 0.3s;
        }

        .phonics-letter {
            font-size: 2rem;
            color: #7B1FA2;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .phonics-sound {
            color: #9C27B0;
            font-style: italic;
            display: block;
            margin-bottom: 10px;
        }

        .phonics-word-item {
            background: white;
            border-radius: 12px;
            padding: 8px 12px;
            margin: 4px;
            display: inline-block;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.95rem;
        }

        .phonics-word-item:hover {
            transform: scale(1.1);
            background: #EDE7F6;
        }

        .min-vh-10 { min-height: 80px; }
    </style>
</head>
<body>

<div class="header">
    <div class="container">
        <h1 class="display-4 fw-bold animate__animated animate__bounceIn">ğŸ’ ä¸‰å¹´çº§æœŸæœ«å¤‡è€ƒç‰¹è®­</h1>
        <p class="lead">è‹±è¯­ã€è¯­æ–‡ã€å¤è¯—ï¼Œå…¨ç§‘é€šå…³ï¼âœ¨</p>
        <div class="mt-3">
            <button class="btn btn-light rounded-pill px-4 shadow-sm" onclick="unlockAudio()">
                ğŸ”Š å¼€å¯å­¦ä¹ é…éŸ³
            </button>
        </div>
    </div>
</div>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="score-badge shadow-sm">â­ å­¦ä¹ èƒ½é‡: <span id="user-score">0</span></div>
        <div class="fw-bold text-danger">ğŸ‘§ å®è´æœ€æ£’ï¼Œè€ƒè¯•åŠ æ²¹ï¼</div>
    </div>

    <ul class="nav nav-pills mb-4 justify-content-center sticky-top bg-transparent p-2" id="mainTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#english-zone">ğŸ”¤ è‹±è¯­å£è¯­</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#phonics-zone">ğŸ—£ï¸ è¯­éŸ³è¾¾äºº</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#poetry-zone">ğŸ® å¿…èƒŒå¤è¯—</button></li>
    </ul>

    <div class="tab-content">
        <!-- è‹±è¯­æ¿å— -->
        <div class="tab-pane fade show active" id="english-zone">
            <div class="row justify-content-center">
                <div class="col-md-9">
                    <div class="module-card text-center animate__animated animate__fadeIn">
                        <div id="english-game-start">
                            <h3 class="mb-4">ğŸ¤ ä¸‰ä¸ŠæœŸæœ«å£è¯­ Q&A ç»ƒä¹  (28é¢˜)</h3>
                            <p class="text-muted mb-4">å…¨é¢è¦†ç›–æœŸæœ«å¿…è€ƒå¯¹è¯ï¼Œæ‹¼å›¾æŒ‘æˆ˜ï¼ŒåŠ æ·±è®°å¿†ï¼</p>
                            <button class="btn btn-primary btn-lg rounded-pill px-5" onclick="startEnglishChallenge()">å¼€å¯é—¯å…³</button>
                        </div>
                        <div id="english-game-play" style="display:none;">
                            <div class="progress mb-4" style="height: 10px; border-radius: 10px;">
                                <div id="english-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                            </div>
                            <div class="question-text" id="current-question">Question?</div>
                            
                            <div id="translation-phase" class="mb-4">
                                <p class="fw-bold text-muted small mb-3">è¿™å¥è¯çš„æ„æ€æ˜¯ï¼š</p>
                                <div id="translation-options" class="d-grid gap-2"></div>
                            </div>

                            <div id="puzzle-phase" style="display:none;">
                                <div id="answer-display" class="p-3 border rounded-4 bg-light min-vh-10 mb-3 text-start d-flex flex-wrap gap-2 align-items-center">
                                    <p class="text-muted small m-0">è¯·æŒ‰é¡ºåºç‚¹å‡»å•è¯æ‹¼å‡ºç­”æ¡ˆ...</p>
                                </div>
                                <div id="word-pool" class="d-flex flex-wrap justify-content-center gap-2"></div>
                            </div>

                            <div class="mt-4" id="english-controls">
                                <button class="btn btn-info rounded-pill text-white px-4" onclick="hearQuestion()">ğŸ”Š å¬é—®é¢˜</button>
                                <button class="btn btn-warning rounded-pill text-white px-4" onclick="showHint()">ğŸ’¡ æç¤º</button>
                            </div>

                            <div id="english-result" class="mt-4 animate__animated" style="display:none;">
                                <h4 class="text-success fw-bold">å¤ªæ£’äº†ï¼æ‹¼å¯¹å•¦ï¼ğŸ‰</h4>
                                <p class="text-muted">è·Ÿæˆ‘è¯»ä¸€éï¼š</p>
                                <h3 id="correct-answer" class="text-primary p-3 bg-light rounded-4 border">Answer</h3>
                                <button class="btn btn-success rounded-pill px-5 mt-3" onclick="nextEnglishQuestion()">ä¸‹ä¸€é¢˜ âœ…</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯­éŸ³è¾¾äººæ¿å— -->
        <div class="tab-pane fade" id="phonics-zone">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="module-card">
                        <h3 class="mb-4 text-center">ğŸ—£ï¸ ä¸‰ä¸Š Phonics è¯­éŸ³é—¯å…³</h3>
                        <p class="text-muted text-center mb-4">è§‚å¯Ÿå•è¯ç»“æ„ï¼Œç»ƒä¹ è‡ªç„¶æ‹¼è¯»ï¼ŒæŒæ¡å­—æ¯å‘éŸ³è§„å¾‹ï¼</p>
                        <div id="phonics-container" class="row g-4"></div>
                    </div>
                </div>
            </div>
        </div>


        <!-- å¤è¯—æ¿å— -->
        <div class="tab-pane fade" id="poetry-zone">
            <div class="row">
                <div class="col-md-12">
                    <div class="module-card">
                        <h3 class="mb-4">ğŸ® å°å­¦ç”Ÿè¯¾æ ‡å¿…èƒŒå¤è¯—è¯ (ç²¾é€‰)</h3>
                        <p class="text-muted mb-4">ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹å…¨æ–‡å¹¶å¬æœ—è¯»ï¼ŒæŒ‘æˆ˜èƒŒè¯µå§ï¼</p>
                        <div class="row g-3" id="poetry-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="maruko-mascot animate__animated animate__bounceIn" onclick="marukoTalk()">
    <img src="https://img.icons8.com/color/96/anime.png" alt="Maruko">
</div>

<audio id="sfx-correct" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- å®Œæ•´è‹±è¯­ Q&A æ•°æ® (28é¢˜) ---
    const englishQuestions = [
        {q: "Good morning.", a: "Good morning.", cn: "æ—©ä¸Šå¥½ã€‚"},
        {q: "What's your name?", a: "My name is Lily.", cn: "ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ"},
        {q: "How old are you?", a: "I'm nine years old.", cn: "ä½ å‡ å²äº†ï¼Ÿ"},
        {q: "Nice to meet you.", a: "Nice to meet you too.", cn: "å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚"},
        {q: "Do you have a pet?", a: "Yes, I do.", cn: "ä½ æœ‰å® ç‰©å—ï¼Ÿ"},
        {q: "What color is it?", a: "It is red.", cn: "å®ƒæ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ"},
        {q: "Let's go to the zoo.", a: "Great idea.", cn: "æˆ‘ä»¬å»åŠ¨ç‰©å›­å§ã€‚"},
        {q: "How many apples do you have?", a: "I have five apples.", cn: "ä½ æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ"},
        {q: "Happy birthday!", a: "Thank you!", cn: "ç”Ÿæ—¥å¿«ä¹ï¼"},
        {q: "What do plants need?", a: "Plants need water and sun.", cn: "æ¤ç‰©éœ€è¦ä»€ä¹ˆï¼Ÿ"},
        {q: "What color is your dog?", a: "It is black and white.", cn: "ä½ çš„ç‹—æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ"},
        {q: "Is this your photo?", a: "Yes, it is.", cn: "è¿™æ˜¯ä½ çš„ç…§ç‰‡å—ï¼Ÿ"},
        {q: "What colours make green?", a: "Blue and yellow make green.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç»¿è‰²ï¼Ÿ"},
        {q: "What colours do you like?", a: "I like red and pink.", cn: "ä½ å–œæ¬¢ä»€ä¹ˆé¢œè‰²ï¼Ÿ"},
        {q: "Do you have a big family?", a: "Yes, I do.", cn: "ä½ æœ‰ä¸€ä¸ªå¤§å®¶åº­å—ï¼Ÿ"},
        {q: "What can plants give us?", a: "Plants can give us fresh air.", cn: "æ¤ç‰©èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼Ÿ"},
        {q: "Are you a good friend?", a: "Yes, I am. I help others.", cn: "ä½ æ˜¯ä¸€ä¸ªå¥½æœ‹å‹å—ï¼Ÿ"},
        {q: "What's that?", a: "It's a tiger.", cn: "é‚£æ˜¯ä»€ä¹ˆï¼Ÿ"},
        {q: "How many tigers do you see?", a: "I see three tigers.", cn: "ä½ çœ‹åˆ°äº†å‡ åªè€è™ï¼Ÿ"},
        {q: "What colours make purple?", a: "Red and blue make purple.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç´«è‰²ï¼Ÿ"},
        {q: "What colours make orange?", a: "Red and yellow make orange.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆæ©™è‰²ï¼Ÿ"},
        {q: "What colours make pink?", a: "Red and white make pink.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç²‰è‰²ï¼Ÿ"},
        {q: "What colours make gray?", a: "Black and white make gray.", cn: "ä»€ä¹ˆé¢œè‰²æ··åˆèƒ½å˜æˆç°è‰²ï¼Ÿ"},
        {q: "Your dog is very cute!", a: "Thank you!", cn: "ä½ çš„ç‹—çœŸå¯çˆ±ï¼"},
        {q: "We can share.", a: "Thank you.", cn: "æˆ‘ä»¬å¯ä»¥åˆ†äº«ã€‚"},
        {q: "Is that your brother?", a: "No, it isn't.", cn: "é‚£æ˜¯ä½ å¼Ÿå¼Ÿå—ï¼Ÿ"},
        {q: "What do friends do?", a: "Friends help and share.", cn: "æœ‹å‹ä¹‹é—´ä¼šåšä»€ä¹ˆï¼Ÿ"},
        {q: "What colour is the grass?", a: "It is green.", cn: "è‰æ˜¯ä»€ä¹ˆé¢œè‰²çš„ï¼Ÿ"}
    ];

    const compositions = [
        {
            title: "ç¬¬ä¸€å•å…ƒã€ŠçŒœçŒœä»–æ˜¯è°ã€‹",
            content: "ä»–æœ‰ä¸€å¼ å¯çˆ±çš„å°å˜´å·´ã€‚é«˜å…´æ—¶ï¼Œä»–æ’‡æ’‡å˜´ï¼Œæ‰®ä¸ªé¬¼è„¸ï¼›ç”Ÿæ°”æ—¶ï¼Œä»–å™˜èµ·çš„å°å˜´å·´èƒ½æŒ‚ä½ä¸€æŠŠå°æ²¹å£¶ã€‚ä»–ååˆ†å¥½åŠ¨ï¼Œæ¯æ¬¡ä¸‹è¯¾éƒ½åƒçŒ´å­ä¼¼çš„è·‘æ¥è·‘å»ã€‚è™½ç„¶ä»–çš„æˆç»©ä¸å¤ªå¥½ï¼Œä½†æ˜¯ä»–çš„åŠ¨æ‰‹èƒ½åŠ›ä»¤å¤§å®¶ååˆ†ä½©æœï¼ä¸€æ¬¡ç­ä¼šè¯¾ä¸Šï¼Œä»–å±…ç„¶å®Œæˆäº†å¤§å®¶éƒ½æ²¡æœ‰å®Œæˆçš„æ’•çº¸ä»»åŠ¡ã€‚ä»–å¯å°±åœ¨æˆ‘ä»¬èº«è¾¹ï¼ŒçŒœçŒœä»–æ˜¯è°ï¼Ÿ"
        },
        {
            title: "ç¬¬äºŒå•å…ƒã€Šå†™æ—¥è®°ã€‹- æ‹”ç‰™",
            content: "ä¸‹åˆï¼Œåƒçº¢èœœæ¡ƒæ—¶ï¼Œæˆ‘çš„ä¸€é¢—ç‰™æ¾åŠ¨äº†ã€‚æ™šé¥­åè¦æ‹”ç‰™äº†ï¼Œæ¥çš„æ˜¯çˆ¸çˆ¸ï¼Œæˆ‘å¿ƒå‡‰äº†åŠæˆªã€‚æˆ‘ä½¿å‡ºâ€œå¤§ç¬‘â€æ’’æ‰‹é”ï¼Œçˆ¸çˆ¸æ²¡æ³•ä¸‹æ‰‹ï¼Œåªå¥½æ¢å¦ˆå¦ˆä¸Šåœºã€‚å¦ˆå¦ˆç”¨ç»†çº¿å¥—ä½ç‰™ï¼Œä¸€è¾¹è·Ÿæˆ‘èŠå¤©åˆ†æ•£æ³¨æ„åŠ›ï¼Œä¸€è¾¹è¶æˆ‘ä¸æ³¨æ„çŒ›åœ°ä¸€æ‹‰ï¼Œç‰™æ‰äº†ï¼ç«Ÿç„¶ä¸€ç‚¹éƒ½ä¸ç—›ï¼ŒåŸæ¥å¦ˆå¦ˆæ‰æ˜¯é«˜æ‰‹ã€‚"
        },
        {
            title: "ç¬¬ä¸‰å•å…ƒã€Šæˆ‘æ¥ç¼–ç«¥è¯ã€‹- éš¾å¿˜çš„ç”Ÿæ—¥",
            content: "ææ™“æ˜çš„çˆ¸çˆ¸å¦ˆå¦ˆåœ¨å¤–åœ°å·¥ä½œï¼Œä»–å¿«è¿‡ç”Ÿæ—¥äº†å´æ²¡äººé™ªã€‚ç»†å¿ƒçš„å°å®å¯Ÿè§‰åï¼Œè¯·è€å¸ˆå¸®å¿™è”ç³»äº†æ™“æ˜çš„çˆ¶æ¯ï¼Œå¹¶å’ŒåŒå­¦ä»¬ç”¨é›¶èŠ±é’±è®¢äº†è›‹ç³•ã€‚ç”Ÿæ—¥é‚£å¤©ï¼Œå¤§å®¶æŠŠæ™“æ˜å®¶è£…é¥°ä¸€æ–°ã€‚å½“æ™“æ˜æ¨å¼€é—¨ï¼Œçœ‹åˆ°çˆ¸çˆ¸å¦ˆå¦ˆå’ŒåŒå­¦ä»¬æ§ç€è›‹ç³•å”±èµ·ç”Ÿæ—¥æ­Œæ—¶ï¼Œä»–æµä¸‹äº†å¹¸ç¦çš„çœ¼æ³ªã€‚è¿™çœŸæ˜¯ä¸€ä¸ªä»¤äººéš¾å¿˜çš„ç”Ÿæ—¥ï¼"
        },
        {
            title: "ç¬¬å››å•å…ƒã€Šç»­å†™æ•…äº‹ã€‹- èš‚èšæ¬ç²®",
            content: "ä¸€åªèš‚èšå‘ç°äº†å‡ ç²’ç±³ï¼Œå®ƒä½¿å‡ºå…¨åŠ›ä¹Ÿæ¬ä¸åŠ¨ã€‚æˆ‘ä»¥ä¸ºå®ƒä¼šæ”¾å¼ƒï¼Œæ²¡æƒ³åˆ°å®ƒå·åœŸé‡æ¥ï¼Œèº«åè·Ÿç€å¤§é˜Ÿäººé©¬ã€‚å®ƒä»¬æœ‰çš„èšæ°”å‡ç¥ï¼Œæœ‰çš„äºŒèšåˆä½œï¼Œæœ‰çš„å‘èµ·è›®åŠ²ã€‚æ²¡è¿‡å¤šä¹…ï¼Œç±³ç²’ä¾¿ç§»å‘äº†èšç©´ã€‚çœ‹ç€è¿™ä¸€å¹•ï¼Œæˆ‘æ˜ç™½äº†ä¸€ä¸ªé“ç†ï¼šå›¢ç»“èµ·æ¥åŠ›é‡å¤§ï¼"
        },
        {
            title: "ç¬¬äº”å•å…ƒã€Šæˆ‘ä»¬çœ¼ä¸­çš„ç¼¤çº·ä¸–ç•Œã€‹- é˜³å°ä¸Šçš„åŠå…°",
            content: "å¦ˆå¦ˆä»å§¥å§¥å®¶å‰ªäº†å‡ æ ¹åŠå…°èŒæ’åœ¨ç›†é‡Œã€‚èµ·åˆå®ƒåƒå®³ç¾çš„å°å§‘å¨˜ï¼Œèº²èº²è—è—ã€‚ç°åœ¨åŠå…°é•¿å¤§äº†ï¼Œå¶å­éšé£æ‘†åŠ¨ï¼Œåƒåœ¨æ¢³ç†é•¿å‘ã€‚å®ƒå¤´ä¸Šå¼€äº†å‡ æœµç²‰çº¢è‰²çš„å°èŠ±ï¼Œè¿œçœ‹åƒæ¸…æ–°è„±ä¿—çš„å°‘å¥³ï¼Œè¿‘çœ‹åƒæ´»æ³¼å¯çˆ±çš„å°å¨ƒå¨ƒã€‚æ¯ä¸€ç“£èŠ±ç“£éƒ½åƒä¸€åªå°èˆ¹ï¼Œè½½ç€éœ²ç ï¼Œç¾æäº†ã€‚"
        },
        {
            title: "ç¬¬å…­å•å…ƒã€Šè¿™å„¿çœŸç¾ã€‹- è¿·äººçš„ç§‹å¤©",
            content: "ç§‹å¤©å¸¦ç€æ¸…å‡‰å’Œæ¸©æŸ”æ‚„æ‚„åœ°æ¥äº†ã€‚å…¬å›­é‡Œï¼Œæ«å¶çº¢å¾—åƒç«ï¼Œæ‰‡èµ°äº†å¤å¤©çš„ç‚çƒ­ã€‚é“¶æå¶åƒä¸€æŠŠæŠŠå°æ‰‡å­ï¼Œæ‰‡å“ªæ‰‡å“ªï¼Œæ‰‡èµ°äº†å¤å¤©çš„ç„¦èºã€‚ç”°é‡é‡Œï¼Œç¨»å­ç†Ÿäº†ï¼Œåƒé“ºäº†ä¸€åœ°çš„é‡‘å­ã€‚æœå›­é‡Œï¼Œæ©˜å­ã€æŸ¿å­ä½ æŒ¤æˆ‘ç¢°ï¼Œäº‰ç€è¦äººä»¬å»æ‘˜å‘¢ï¼ç§‹å¤©çœŸæ˜¯ä¸€å¹…ç¾ä¸½çš„å›¾ç”»ã€‚"
        },
        {
            title: "ç¬¬ä¸ƒå•å…ƒã€Šæˆ‘æœ‰ä¸€ä¸ªæƒ³æ³•ã€‹- ä¿æŠ¤ç¯å¢ƒ",
            content: "æˆ‘å‘ç°å­¦æ ¡æ“åœºçš„å°è§’è½ç»å¸¸æœ‰çº¸å±‘ã€‚æˆ‘æƒ³ï¼Œå¦‚æœæ¯ä¸ªåŒå­¦éƒ½èƒ½éšæ‰‹æ¡èµ·åœ°ä¸Šçš„åƒåœ¾ï¼Œæˆ‘ä»¬çš„æ ¡å›­ä¼šå˜å¾—æ›´åŠ ç¾ä¸½ã€‚æˆ‘å»ºè®®å­¦æ ¡å¯ä»¥è®¾ç«‹â€œç¯ä¿å°å«å£«â€å²—ä½ï¼Œé¼“åŠ±å¤§å®¶çˆ±æŠ¤ç¯å¢ƒã€‚åªè¦æˆ‘ä»¬æ¯ä¸ªäººéƒ½å‡ºä¸€ä»½åŠ›ï¼Œä¸–ç•Œä¸€å®šä¼šå˜å¾—æ›´ç»¿ã€æ›´ç¾ã€‚"
        },
        {
            title: "ç¬¬å…«å•å…ƒã€Šé‚£æ¬¡ç»å†çœŸéš¾å¿˜ã€‹- ç¬¬ä¸€æ¬¡è®²æ•…äº‹",
            content: "ç­ä¼šè¯¾ä¸Šï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä¸Šå°è®²æ•…äº‹ã€‚æˆ‘å¿ƒé‡Œæ€¦æ€¦ç›´è·³ï¼Œè…¿éƒ½æœ‰ç‚¹å‘è½¯ã€‚ä½†æˆ‘å’¬å’¬ç‰™ï¼Œä¸¾èµ·äº†æ‰‹ã€‚åˆšå¼€å§‹å£°éŸ³æŠ–å¾—åƒé£ä¸­çš„æ ‘å¶ï¼Œä½†çœ‹åˆ°è€å¸ˆé¼“åŠ±çš„çœ¼ç¥ï¼Œæˆ‘é‡æ–°å®šäº†å®šç¥ï¼Œè®²å¾—ç»˜å£°ç»˜è‰²ã€‚è®²å®Œåæ•™å®¤é‡Œå“èµ·äº†æŒå£°ï¼Œè€å¸ˆä¹Ÿå¤¸å¥–äº†æˆ‘ã€‚åŸæ¥å‹‡æ•¢è¯•ä¸€è¯•ï¼Œå°±èƒ½æ”¶è·å¿«ä¹ã€‚"
        }
    ];

    const poems = [
        {title: "æ‰€è§", author: "è¢æš", content: "ç‰§ç«¥éª‘é»„ç‰›ï¼Œæ­Œå£°æŒ¯æ—æ¨¾ã€‚æ„æ¬²æ•é¸£è‰ï¼Œå¿½ç„¶é—­å£ç«‹ã€‚"},
        {title: "å±±è¡Œ", author: "æœç‰§", content: "è¿œä¸Šå¯’å±±çŸ³å¾„æ–œï¼Œç™½äº‘ç”Ÿå¤„æœ‰äººå®¶ã€‚åœè½¦åçˆ±æ«æ—æ™šï¼Œéœœå¶çº¢äºäºŒæœˆèŠ±ã€‚"},
        {title: "èµ åˆ˜æ™¯æ–‡", author: "è‹è½¼", content: "è·å°½å·²æ— æ“é›¨ç›–ï¼ŒèŠæ®‹çŠ¹æœ‰å‚²éœœæã€‚ä¸€å¹´å¥½æ™¯å›é¡»è®°ï¼Œæœ€æ˜¯æ©™é»„æ©˜ç»¿æ—¶ã€‚"},
        {title: "å¤œä¹¦æ‰€è§", author: "å¶ç»ç¿", content: "è§è§æ¢§å¶é€å¯’å£°ï¼Œæ±Ÿä¸Šç§‹é£åŠ¨å®¢æƒ…ã€‚çŸ¥æœ‰å„¿ç«¥æŒ‘ä¿ƒç»‡ï¼Œå¤œæ·±ç¯±è½ä¸€ç¯æ˜ã€‚"},
        {title: "æœ›å¤©é—¨å±±", author: "æç™½", content: "å¤©é—¨ä¸­æ–­æ¥šæ±Ÿå¼€ï¼Œç¢§æ°´ä¸œæµè‡³æ­¤å›ã€‚ä¸¤å²¸é’å±±ç›¸å¯¹å‡ºï¼Œå­¤å¸†ä¸€ç‰‡æ—¥è¾¹æ¥ã€‚"},
        {title: "é¥®æ¹–ä¸Šåˆæ™´åé›¨", author: "è‹è½¼", content: "æ°´å…‰æ½‹æ»Ÿæ™´æ–¹å¥½ï¼Œå±±è‰²ç©ºè’™é›¨äº¦å¥‡ã€‚æ¬²æŠŠè¥¿æ¹–æ¯”è¥¿å­ï¼Œæ·¡å¦†æµ“æŠ¹æ€»ç›¸å®œã€‚"},
        {title: "æœ›æ´åº­", author: "åˆ˜ç¦¹é”¡", content: "æ¹–å…‰ç§‹æœˆä¸¤ç›¸å’Œï¼Œæ½­é¢æ— é£é•œæœªç£¨ã€‚é¥æœ›æ´åº­å±±æ°´ç¿ ï¼Œç™½é“¶ç›˜é‡Œä¸€é’èºã€‚"},
        {title: "æ—©å‘ç™½å¸åŸ", author: "æç™½", content: "æœè¾ç™½å¸å½©äº‘é—´ï¼Œåƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚"},
        {title: "é‡‡è²æ›²", author: "ç‹æ˜Œé¾„", content: "è·å¶ç½—è£™ä¸€è‰²è£ï¼ŒèŠ™è“‰å‘è„¸ä¸¤è¾¹å¼€ã€‚ä¹±å…¥æ± ä¸­çœ‹ä¸è§ï¼Œé—»æ­Œå§‹è§‰æœ‰äººæ¥ã€‚"}
    ];

    let state = {
        score: parseInt(localStorage.getItem('grade3_exam_score')) || 0,
        englishIndex: 0,
        puzzleOrder: [],
        unlocked: false
    };

    // --- è¯­éŸ³é€»è¾‘ (Phonics) ---
    const phonicsData = [
        { letter: "Aa", sound: "/ Ã¦ /", words: ["bag", "can", "and", "cat", "bad", "dad", "cab", "mad", "apple", "sad", "ant", "rat", "hat", "bat", "cap", "rabbit", "have", "hand", "van", "jam", "map", "nap", "fan", "ham"] },
        { letter: "Bb", sound: "/ b /", words: ["bed", "bag", "Bob", "cab", "big", "boy", "buy", "banana", "baby", "bear", "black", "blue", "back", "bread", "brown", "but"] },
        { letter: "Cc", sound: "/ k /", words: ["cat", "cut", "can", "cab", "cup", "cake", "cute", "colour", "close", "clean", "class", "computer", "cap", "car", "card", "come"] },
        { letter: "Dd", sound: "/ d /", words: ["dog", "bad", "dad", "sad", "dark", "day", "desk", "doll", "duck", "deer", "deep", "mud", "door", "down", "dance", "dinner"] },
        { letter: "Ee", sound: "/ e /", words: ["egg", "pet", "leg", "web", "set", "elephant", "desk", "yellow", "member", "bed", "nest", "pen", "red", "seven", "ten", "men", "bell", "end", "vet", "wet", "fed", "hen", "help", "jet"] },
        { letter: "Ff", sound: "/ f /", words: ["fish", "for", "from", "fire", "floor", "fruit", "five", "beef", "four", "fast", "fly", "fox", "friend", "family", "far", "food", "frog", "foot", "flower", "find", "farm", "funny", "fat", "fear"] },
        { letter: "Gg", sound: "/ g /", words: ["go", "gift", "bug", "grass", "glad", "pig", "girl", "flag", "tag", "frog", "glass", "grape", "green", "grow", "give", "game", "tiger", "guess", "get", "leg"] },
        { letter: "Hh", sound: "/ h /", words: ["hot", "help", "hit", "hear", "her", "his", "hat", "head", "hand", "have", "how", "home", "hope", "happy", "house", "hair"] },
        { letter: "Ii", sound: "/ Éª /", words: ["ill", "kid", "big", "dig", "sit", "six", "fix", "pig", "pin", "lip", "sip", "hit", "fit", "win", "fin", "bin", "pick", "little", "city", "window"] },
        { letter: "Jj", sound: "/ dÊ’ /", words: ["job", "Jim", "joy", "jet", "jam", "juice", "June", "July", "jog", "jump", "jungle", "jacket"] },
        { letter: "Kk", sound: "/ k /", words: ["Kim", "kite", "kid", "key", "kind", "keep", "kick", "kitchen", "cook", "milk", "drink", "look", "book", "dark", "park", "talk", "work", "mask", "risk", "bank"] },
        { letter: "Ll", sound: "/ l /", words: ["leg", "lion", "lab", "link", "like", "love", "listen", "light", "little", "plant", "late", "long", "lamp", "lamb", "yellow", "let"] },
        { letter: "Mm", sound: "/ m /", words: ["map", "mother", "mouse", "money", "mud", "men", "my", "maths", "mouth", "mum", "make", "monkey", "meet", "summer", "member", "Monday", "March", "me", "Miss", "Mr"] },
        { letter: "Nn", sound: "/ n /", words: ["new", "pan", "need", "nose", "noodles", "not", "nap", "nine", "nice", "nurse", "fan", "no", "name", "night", "near", "now", "never", "net", "noon"] },
        { letter: "Oo", sound: "/ É’ /", words: ["box", "dot", "body", "lock", "orange", "job", "log", "shop", "sock", "hop", "cop", "top", "pot", "hot", "frog", "fog", "drop", "fox", "mop", "on"] },
        { letter: "Pp", sound: "/ p /", words: ["cup", "pen", "pink", "pet", "plant", "sleep", "help", "party", "people", "parent", "pretty", "paint", "pig", "pan", "purple", "panda", "plane", "park", "hope", "piano", "happy", "peel", "polite", "put"] },
        { letter: "Qq", sound: "/ kw /", words: ["quit", "quiet", "queen", "quick", "question", "quilt", "quiz", "quarter"] },
        { letter: "Rr", sound: "/ r /", words: ["red", "ride", "from", "friend", "fresh", "fruit", "ruler", "race", "rock", "rat", "rest", "rude", "robot", "run", "read", "rabbit"] },
        { letter: "Ss", sound: "/ s /", words: ["see", "say", "small", "some", "sister", "so", "set", "sea", "sun", "six", "school", "grass", "bus", "seven", "study", "goose"] },
        { letter: "Tt", sound: "/ t /", words: ["Ted", "sit", "tall", "talk", "vet", "tea", "mat", "hat", "taste", "table", "tap", "tiger", "hit", "nut", "cut", "tub", "cat", "hot", "shirt", "eat"] },
        { letter: "Uu", sound: "/ ÊŒ /", words: ["run", "up", "cut", "nut", "fun", "mud", "mug", "cup", "jump", "lucky", "sun", "bus", "uncle", "gum", "duck", "tub", "bug", "us", "plus", "hug"] },
        { letter: "Vv", sound: "/ v /", words: ["van", "vet", "vat", "vest", "very", "visit", "vacation", "five", "give", "live", "drive", "over", "wave", "love", "river", "vegetable"] },
        { letter: "Ww", sound: "/ w /", words: ["we", "win", "won", "with", "swim", "well", "wig", "will", "want", "week", "west", "wall", "wave", "wait", "walk", "warm", "water", "wind", "wood", "window"] },
        { letter: "Xx", sound: "/ ks /", words: ["box", "six", "fix", "tax", "taxi", "fox", "mix", "sex"] },
        { letter: "Yy", sound: "/ j /", words: ["yum", "yo-yo", "yellow", "yes", "year", "yell", "you", "yard", "young", "yeah", "your"] },
        { letter: "Zz", sound: "/ z /", words: ["Zip", "zero", "zig", "zebra", "zoo", "size", "lazy", "zone"] }
    ];

    function loadPhonics() {
        const container = document.getElementById('phonics-container');
        phonicsData.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'col-md-6 col-lg-4';
            card.innerHTML = `
                <div class="phonics-card animate__animated animate__fadeInUp" style="animation-delay: ${i*0.1}s">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <span class="phonics-letter">${item.letter}</span>
                            <span class="phonics-sound">${item.sound}</span>
                        </div>
                        <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="playPhonicsSound('${item.letter}', '${item.sound}')">ğŸ”Š å‘éŸ³</button>
                    </div>
                    <div class="phonics-words">
                        ${item.words.map(word => `<span class="phonics-word-item" onclick="speak('${word}')">${word}</span>`).join('')}
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function playPhonicsSound(letter, sound) {
        speak(letter[0], 0.8, () => {
            setTimeout(() => {
                speak(letter[0], 0.6); 
            }, 500);
        });
    }

    // --- é¡µé¢åˆå§‹åŒ– ---
    window.onload = () => {
        updateScore(0);
        loadPoetry();
        loadPhonics();
    };

    function updateScore(pts) {
        state.score += pts;
        document.getElementById('user-score').innerText = state.score;
        localStorage.setItem('grade3_exam_score', state.score);
        if(pts > 0) showFeedback();
    }

    function showFeedback() {
        const pop = document.getElementById('feedback-pop');
        if(!pop) {
            const div = document.createElement('div');
            div.id = 'feedback-pop';
            div.className = 'fixed-top text-center display-1 animate__animated animate__zoomIn';
            div.style.zIndex = '2000';
            div.style.top = '40%';
            document.body.appendChild(div);
        }
        const emojis = ['ğŸ‰', 'â­', 'ğŸˆ', 'âœ¨', 'ğŸ†'];
        const p = document.getElementById('feedback-pop');
        p.innerText = emojis[Math.floor(Math.random()*emojis.length)];
        p.style.display = 'block';
        setTimeout(() => p.style.display = 'none', 1000);
        document.getElementById('sfx-correct').play();
    }

    function unlockAudio() {
        state.unlocked = true;
        speak("åŠ æ²¹åŠ æ²¹ï¼");
        alert("è¯­éŸ³åŠŸèƒ½å·²å¼€å¯ï¼");
    }

    function speak(text, rate = 1.0, callback) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = text.match(/[\u4e00-\u9fa5]/) ? 'zh-CN' : 'en-US';
        utter.rate = rate;
        if(callback) utter.onend = callback;
        window.speechSynthesis.speak(utter);
    }

    // --- è‹±è¯­é€»è¾‘ ---
    function startEnglishChallenge() {
        state.englishIndex = 0;
        document.getElementById('english-game-start').style.display = 'none';
        document.getElementById('english-game-play').style.display = 'block';
        loadEnglishQuestion();
    }

    function loadEnglishQuestion() {
        const q = englishQuestions[state.englishIndex];
        document.getElementById('current-question').innerText = q.q;
        document.getElementById('english-progress').style.width = `${(state.englishIndex / englishQuestions.length) * 100}%`;
        
        const optionsDiv = document.getElementById('translation-options');
        optionsDiv.innerHTML = '';
        const options = [q.cn];
        while(options.length < 4) {
            const randomCn = englishQuestions[Math.floor(Math.random()*englishQuestions.length)].cn;
            if(!options.includes(randomCn)) options.push(randomCn);
        }
        options.sort(() => Math.random() - 0.5).forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'translation-option animate__animated animate__fadeIn';
            btn.innerText = opt;
            btn.onclick = () => checkTranslation(opt, btn);
            optionsDiv.appendChild(btn);
        });

        document.getElementById('translation-phase').style.display = 'block';
        document.getElementById('puzzle-phase').style.display = 'none';
        document.getElementById('english-result').style.display = 'none';
        speak(q.q);
    }

    function checkTranslation(selected, btn) {
        const q = englishQuestions[state.englishIndex];
        if(selected === q.cn) {
            btn.classList.add('bg-success', 'text-white');
            setTimeout(() => {
                document.getElementById('translation-phase').style.display = 'none';
                loadPuzzle();
            }, 600);
        } else {
            btn.classList.add('bg-danger', 'text-white', 'animate__shakeX');
            speak("ä¸å¯¹å“¦ï¼Œå†æƒ³æƒ³");
            setTimeout(() => btn.className = 'translation-option', 1000);
        }
    }

    function loadPuzzle() {
        const q = englishQuestions[state.englishIndex];
        document.getElementById('puzzle-phase').style.display = 'block';
        document.getElementById('answer-display').innerHTML = '<p class="text-muted small m-0">æ‹¼å‡ºè‹±æ–‡å›ç­”...</p>';
        state.puzzleOrder = [];
        
        const words = q.a.split(' ');
        const pool = document.getElementById('word-pool');
        pool.innerHTML = '';
        [...words].sort(() => Math.random() - 0.5).forEach(w => {
            const div = document.createElement('div');
            div.className = 'word-block shadow-sm animate__animated animate__fadeIn';
            div.innerText = w;
            div.onclick = () => selectWord(w, div);
            pool.appendChild(div);
        });
    }

    function selectWord(word, el) {
        if(el.style.visibility === 'hidden') return;
        const q = englishQuestions[state.englishIndex];
        const words = q.a.split(' ');
        if(word === words[state.puzzleOrder.length]) {
            state.puzzleOrder.push(word);
            el.style.visibility = 'hidden';
            const display = document.getElementById('answer-display');
            if(state.puzzleOrder.length === 1) display.innerHTML = '';
            display.innerHTML += `<span class="badge bg-primary p-2 animate__animated animate__bounceIn m-1">${word}</span> `;
            speak(word);
            if(state.puzzleOrder.length === words.length) {
                showSuccess();
            }
        } else {
            el.classList.add('bg-danger', 'text-white', 'animate__shakeX');
            setTimeout(() => el.classList.remove('bg-danger', 'text-white', 'animate__shakeX'), 500);
            speak("ä¸å¯¹å“¦");
        }
    }

    function showSuccess() {
        const q = englishQuestions[state.englishIndex];
        document.getElementById('english-result').style.display = 'block';
        document.getElementById('correct-answer').innerText = q.a;
        speak(q.a, 0.9, () => updateScore(10));
    }

    function nextEnglishQuestion() {
        state.englishIndex++;
        if(state.englishIndex < englishQuestions.length) {
            loadEnglishQuestion();
        } else {
            alert("é€šå…³å•¦ï¼å®è´ä½ æ˜¯æœ€æ£’çš„ï¼ğŸ‘");
            startEnglishChallenge();
        }
    }

    function hearQuestion() {
        speak(englishQuestions[state.englishIndex].q);
    }

    function showHint() {
        alert("æ‚„æ‚„å‘Šè¯‰ä½ ï¼Œç­”æ¡ˆæ˜¯: " + englishQuestions[state.englishIndex].a);
    }

    // --- è¯­æ–‡é€»è¾‘ ---
    function loadCompositions() {
        const list = document.getElementById('composition-list');
        compositions.forEach((c, i) => {
            list.innerHTML += `
                <div class="col-12">
                    <div class="composition-card animate__animated animate__fadeInLeft" style="animation-delay: ${i*0.2}s">
                        <h5 class="fw-bold text-danger mb-3">ğŸ“ ${c.title}</h5>
                        <p>${c.content}</p>
                        <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="speak('${c.content.replace(/'/g, "\\'")}', 0.85)">ğŸ”Š å¬èŒƒæ–‡æœ—è¯»</button>
                    </div>
                </div>
            `;
        });
    }

    // --- å¤è¯—é€»è¾‘ ---
    function loadPoetry() {
        const container = document.getElementById('poetry-list');
        container.innerHTML = poems.map((p, idx) => `
            <div class="col-md-4">
                <div class="poetry-card" onclick="flipPoetry(this, ${idx})">
                    <div class="poetry-front">
                        <div class="poetry-title" style="font-weight: bold; color: #2E7D32; font-size: 1.3rem; margin-bottom: 10px;">${p.title}</div>
                        <div class="text-muted small">${p.author}</div>
                        <div class="mt-2 text-success"><i class="bi bi-arrow-repeat"></i> ç‚¹å‡»ç¿»è½¬</div>
                    </div>
                    <div class="poetry-back">
                        <div class="poetry-content-full">${p.content.split('ã€‚').join('ã€‚<br>')}</div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function flipPoetry(card, idx) {
        card.classList.toggle('is-flipped');
        if (card.classList.contains('is-flipped')) {
            speak(poems[idx].title + "ã€‚" + poems[idx].author + "ã€‚" + poems[idx].content);
        }
    }

    function marukoTalk() {
        const lines = ["å®è´ï¼ŒåŠ æ²¹å¤ä¹ å“¦ï¼", "å°ä¸¸å­é™ªç€ä½ ï¼Œè€ƒ 100 åˆ†ï¼", "ä½ æ˜¯æœ€æ£’çš„å°æ‰å¥³ï¼", "è‹±è¯­å’Œè¯­æ–‡éƒ½è¦åŠ æ²¹ï¼"];
        const line = lines[Math.floor(Math.random()*lines.length)];
        speak(line);
        alert("å°ä¸¸å­è¯´ï¼š" + line);
    }
</script>
</body>
</html>
