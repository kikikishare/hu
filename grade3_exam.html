<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å¹´çº§æœŸæœ«å¤§å†²åˆº - åŠ©åŠ›å®è´æ‹¿é«˜åˆ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #FF8A80;
            --secondary-color: #FFD54F;
            --success-color: #81C784;
            --bg-color: #FFF9F0;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }

        body {
            background-color: var(--bg-color);
            font-family: 'PingFang SC', 'zcool-gdt', system-ui, -apple-system, sans-serif;
            color: #4E342E;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, #FFAB91, #FF7043);
            color: white;
            padding: 2.5rem 0;
            text-align: center;
            border-bottom-left-radius: 60px;
            border-bottom-right-radius: 60px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.3);
        }

        .nav-pills .nav-link {
            border-radius: 30px;
            padding: 12px 25px;
            font-weight: 600;
            color: #795548;
            transition: all 0.3s;
            background: white;
            margin: 5px;
            box-shadow: var(--card-shadow);
        }

        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .module-card {
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .score-badge {
            background: #FFD54F;
            color: #F57C00;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .maruko-mascot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }

        .maruko-mascot:hover { transform: scale(1.1) rotate(-5deg); }

        /* ç»ƒä¹ å®¹å™¨ */
        .exercise-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #FFFDE7;
            border-radius: 25px;
            border: 2px dashed #FBC02D;
        }
        .exercise-option {
            background: white;
            border: 2px solid #FFF176;
            border-radius: 15px;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
        }
        .exercise-option:hover {
            background: #FFF9C4;
            transform: scale(1.05);
        }
        .exercise-option.correct {
            background: #C8E6C9;
            border-color: #4CAF50;
            color: #2E7D32;
        }
        .exercise-option.wrong {
            background: #FFCDD2;
            border-color: #F44336;
            color: #C62828;
        }
        .exercise-sentence {
            font-size: 1.3rem;
            margin-bottom: 20px;
            line-height: 2;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="container">
        <h1 class="display-4 fw-bold animate__animated animate__bounceIn">ğŸ’ ä¸‰å¹´çº§è¯­æ–‡å¤‡è€ƒç‰¹è®­</h1>
        <p class="lead">è¯­æ–‡æ ¸å¿ƒç´ å…»æå‡ï¼ŒåŠ©ä½ æ‹¿é«˜åˆ†ï¼âœ¨</p>
        <div class="mt-3">
            <button class="btn btn-light rounded-pill px-4 shadow-sm" onclick="unlockAudio()">
                ğŸ”Š å¼€å¯å­¦ä¹ é…éŸ³
            </button>
        </div>
    </div>
</div>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="score-badge shadow-sm">â­ å­¦ä¹ èƒ½é‡: <span id="user-score">0</span></div>
        <div class="fw-bold text-danger">ğŸ‘§ å®è´æœ€æ£’ï¼Œè€ƒè¯•åŠ æ²¹ï¼</div>
    </div>

    <ul class="nav nav-pills mb-4 justify-content-center sticky-top bg-transparent p-2" id="mainTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#syn-zone">ğŸŒ“ è¿‘/åä¹‰è¯</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#idiom-zone">ğŸ§  æˆè¯­æŒ‘æˆ˜</button></li>
    </ul>

    <div class="tab-content">
        <!-- è¿‘/åä¹‰è¯æ¿å— -->
        <div class="tab-pane fade show active" id="syn-zone">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="module-card">
                        <h3 class="mb-4 text-center">ğŸŒ“ è¿‘ä¹‰è¯ä¸åä¹‰è¯</h3>
                        <p class="text-muted text-center mb-4">ç§¯ç´¯è¯æ±‡é‡ï¼Œè®©å†™ä½œæ›´ç”ŸåŠ¨ï¼</p>
                        <div class="text-center mb-4">
                            <button class="btn btn-warning rounded-pill px-4" onclick="startSynExercise()">ğŸ¯ è¯æ±‡å¤§è€ƒéªŒ</button>
                        </div>
                        <div id="syn-exercise" class="exercise-container text-center">
                            <div class="mb-3"><span class="badge bg-warning text-dark">è€ƒéªŒä¸­...</span></div>
                            <div class="exercise-sentence" id="syn-ex-sentence"></div>
                            <div id="syn-ex-options" class="d-flex flex-wrap justify-content-center"></div>
                            <div class="mt-4">
                                <button class="btn btn-outline-secondary btn-sm" onclick="stopSynExercise()">é€€å‡ºè€ƒéªŒ</button>
                            </div>
                        </div>
                        <div id="syn-container" class="row g-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆè¯­æ¿å— -->
        <div class="tab-pane fade" id="idiom-zone">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="module-card">
                        <h3 class="mb-4 text-center">ğŸ§  æˆè¯­å¤§é—¯å…³</h3>
                        <p class="text-muted text-center mb-4">å­¦å¥½æˆè¯­ï¼Œå‡ºå£æˆç« ï¼</p>
                        <div class="text-center mb-4">
                            <button class="btn btn-warning rounded-pill px-4" onclick="startIdiomChallenge()">ğŸ¯ æ™ºæ…§å¤§æŒ‘æˆ˜</button>
                        </div>
                        <div id="idiom-exercise" class="exercise-container text-center">
                            <div class="mb-3"><span class="badge bg-warning text-dark">æŒ‘æˆ˜ä¸­...</span></div>
                            <div class="exercise-sentence" id="idiom-ex-sentence"></div>
                            <div id="idiom-ex-options" class="d-flex flex-wrap justify-content-center"></div>
                            <div class="mt-4">
                                <button class="btn btn-outline-secondary btn-sm" onclick="stopIdiomChallenge()">é€€å‡ºæŒ‘æˆ˜</button>
                            </div>
                        </div>
                        <div id="idiom-container" class="row g-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="maruko-mascot animate__animated animate__bounceIn" onclick="marukoTalk()">
    <img src="https://img.icons8.com/color/96/anime.png" alt="Maruko">
</div>

<audio id="sfx-correct" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- è¿‘/åä¹‰è¯æ•°æ® ---
    const synonymsData = [
        {"word": "æ¼‚äº®", "synonyms": ["ç¾ä¸½", "å¥½çœ‹"], "antonyms": ["ä¸‘é™‹", "éš¾çœ‹"]},
        {"word": "å¿«ä¹", "synonyms": ["é«˜å…´", "å¹¸ç¦", "å–œæ‚¦"], "antonyms": ["å¿§æ„", "æ‚²ä¼¤", "ç—›è‹¦"]},
        {"word": "å®½é˜”", "synonyms": ["å®½å¹¿", "å¹¿é˜”"], "antonyms": ["ç‹­çª„", "çª„å°"]},
        {"word": "å¯»æ‰¾", "synonyms": ["å¯»è§…", "æ‰¾å¯»"], "antonyms": ["ä¸¢å¤±", "é—å¤±"]},
        {"word": "ç«‹åˆ»", "synonyms": ["é©¬ä¸Š", "é¡¿æ—¶", "å³åˆ»"], "antonyms": ["è¿Ÿç¼“", "ç¼“æ…¢"]},
        {"word": "æ¸©æŸ”", "synonyms": ["æ¸©é¡º", "å’Œè”¼"], "antonyms": ["ç²—æš´", "å‡¶ç‹ "]},
        {"word": "ä»”ç»†", "synonyms": ["è®¤çœŸ", "ç»†å¿ƒ"], "antonyms": ["é©¬è™", "ç²—å¿ƒ"]},
        {"word": "å¼ºçƒˆ", "synonyms": ["çŒ›çƒˆ", "å‰§çƒˆ"], "antonyms": ["å¾®å¼±", "æŸ”å’Œ"]},
        {"word": "è°¦è™š", "synonyms": ["è™šå¿ƒ"], "antonyms": ["éª„å‚²", "è‡ªæ»¡"]},
        {"word": "å‹‡æ•¢", "synonyms": ["èƒ†å¤§", "è‹±å‹‡"], "antonyms": ["èƒ†æ€¯", "æ‡¦å¼±"]}
    ];

    // --- æˆè¯­æ•°æ® ---
    const idiomsData = [
        {"idiom": "ä¸€é©¬å½“å…ˆ", "meaning": "å½¢å®¹é¢†å…ˆï¼Œä¹Ÿæ¯”å–»å·¥ä½œèµ°åœ¨ç¾¤ä¼—å‰é¢ï¼Œç§¯æå¸¦å¤´ã€‚", "example": "åœ¨æ¯”èµ›ä¸­ï¼Œä»–ä¸€é©¬å½“å…ˆï¼Œå†²åˆ°äº†æœ€å‰é¢ã€‚"},
        {"idiom": "ä¸¤è¢–æ¸…é£", "meaning": "å½¢å®¹åšå®˜å»‰æ´ï¼Œé™¤ä¸¤åªè¢–å­é‡Œçš„æ¸…é£å¤–ï¼Œåˆ«æ— æ‰€æœ‰ã€‚", "example": "ä»–å½“äº†å¤šå¹´æ¸…å®˜ï¼Œç¦»èŒæ—¶çœŸæ˜¯ä¸¤è¢–æ¸…é£ã€‚"},
        {"idiom": "ä¸‰å¿ƒäºŒæ„", "meaning": "åˆæƒ³è¿™æ ·åˆæƒ³é‚£æ ·ï¼ŒçŠ¹è±«ä¸å®šã€‚ä¹ŸæŒ‡ä¸ä¸“å¿ƒã€‚", "example": "æˆ‘ä»¬å­¦ä¹ ä¸èƒ½ä¸‰å¿ƒäºŒæ„ï¼Œè¦ä¸“å¿ƒè‡´å¿—ã€‚"},
        {"idiom": "å››é¢æ¥šæ­Œ", "meaning": "æ¯”å–»é™·å…¥å››é¢å—æ•Œã€å­¤ç«‹æ— æ´çš„å¢ƒåœ°ã€‚", "example": "æ•Œäººå·²ç»é™·å…¥äº†å››é¢æ¥šæ­Œçš„å¢ƒåœ°ã€‚"},
        {"idiom": "äº”å½©ç¼¤çº·", "meaning": "æŒ‡é¢œè‰²ç¹å¤šï¼Œéå¸¸å¥½çœ‹ã€‚", "example": "èŠ±å›­é‡Œçš„èŠ±äº”å½©ç¼¤çº·ï¼ŒçœŸç¾ä¸½ã€‚"},
        {"idiom": "å…­ç¥æ— ä¸»", "meaning": "å½¢å®¹æƒŠæ…Œå¤±æªï¼Œä¸çŸ¥å¦‚ä½•æ˜¯å¥½ã€‚", "example": "å¬åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œä»–é¡¿æ—¶æƒŠå¾—å…­ç¥æ— ä¸»ã€‚"},
        {"idiom": "ä¸ƒæ‰‹å…«è„š", "meaning": "å½¢å®¹äººå¤šæ‰‹æ‚ï¼ŒåŠ¨ä½œçº·ä¹±ã€‚", "example": "å¤§å®¶ä¸ƒæ‰‹å…«è„šåœ°æŠŠå±‹å­æ”¶æ‹¾å¹²å‡€äº†ã€‚"},
        {"idiom": "å…«ä»™è¿‡æµ·", "meaning": "æ¯”å–»å„è‡ªæ‹¿å‡ºæœ¬é¢†æˆ–åŠæ³•ï¼Œäº’ç›¸ç«èµ›ã€‚", "example": "åœ¨è¿™æ¬¡æ¯”èµ›ä¸­ï¼Œå¤§å®¶å…«ä»™è¿‡æµ·ï¼Œå„æ˜¾ç¥é€šã€‚"},
        {"idiom": "ä¹ç‰›ä¸€æ¯›", "meaning": "æ¯”å–»æå¤§æ•°é‡ä¸­æå¾®å°çš„æ•°é‡ï¼Œå¾®ä¸è¶³é“ã€‚", "example": "è¿™ç‚¹é’±å¯¹ä»–æ¥è¯´åªæ˜¯ä¹ç‰›ä¸€æ¯›ã€‚"},
        {"idiom": "åå…¨åç¾", "meaning": "æŒ‡å„æ–¹é¢éƒ½éå¸¸å®Œç¾ï¼Œæ¯«æ— ç¼ºé™·ã€‚", "example": "ä¸–ç•Œä¸Šæ²¡æœ‰åå…¨åç¾çš„äººã€‚"}
    ];

    let state = {
        score: parseInt(localStorage.getItem('grade3_exam_score')) || 0,
        unlocked: false
    };

    // --- é¡µé¢åˆå§‹åŒ– ---
    window.onload = () => {
        updateScore(0);
        loadSyn();
        loadIdiom();
    };

    function updateScore(pts) {
        state.score += pts;
        document.getElementById('user-score').innerText = state.score;
        localStorage.setItem('grade3_exam_score', state.score);
        if(pts > 0) showFeedback();
    }

    function showFeedback() {
        const pop = document.getElementById('feedback-pop');
        if(!pop) {
            const div = document.createElement('div');
            div.id = 'feedback-pop';
            div.className = 'fixed-top text-center display-1 animate__animated animate__zoomIn';
            div.style.zIndex = '2000';
            div.style.top = '40%';
            document.body.appendChild(div);
        }
        const emojis = ['ğŸ‰', 'â­', 'ğŸˆ', 'âœ¨', 'ğŸ†'];
        const p = document.getElementById('feedback-pop');
        p.innerText = emojis[Math.floor(Math.random()*emojis.length)];
        p.style.display = 'block';
        setTimeout(() => p.style.display = 'none', 1000);
        document.getElementById('sfx-correct').play();
    }

    function unlockAudio() {
        state.unlocked = true;
        speak("åŠ æ²¹åŠ æ²¹ï¼");
        alert("è¯­éŸ³åŠŸèƒ½å·²å¼€å¯ï¼");
    }

    function speak(text, rate = 1.0, callback) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = text.match(/[\u4e00-\u9fa5]/) ? 'zh-CN' : 'en-US';
        utter.rate = rate;
        if(callback) utter.onend = callback;
        window.speechSynthesis.speak(utter);
    }

    // --- è¿‘/åä¹‰è¯é€»è¾‘ ---
    function loadSyn() {
        const container = document.getElementById('syn-container');
        container.innerHTML = synonymsData.map((item, i) => `
            <div class="col-md-6">
                <div class="module-card shadow-sm animate__animated animate__fadeIn" style="border-left: 5px solid #FFD54F;">
                    <h5 class="fw-bold text-primary mb-3">${item.word}</h5>
                    <div class="mb-2">
                        <span class="badge bg-warning text-dark me-2">è¿‘ä¹‰è¯</span>
                        <span class="text-muted">${item.synonyms.join('ã€')}</span>
                    </div>
                    <div>
                        <span class="badge bg-secondary me-2">åä¹‰è¯</span>
                        <span class="text-muted">${item.antonyms.join('ã€')}</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    let synExState = { current: null };
    function startSynExercise() {
        document.getElementById('syn-container').style.display = 'none';
        document.getElementById('syn-exercise').style.display = 'block';
        nextSynQuestion();
    }
    function stopSynExercise() {
        document.getElementById('syn-container').style.display = 'flex';
        document.getElementById('syn-exercise').style.display = 'none';
    }
    function nextSynQuestion() {
        const item = synonymsData[Math.floor(Math.random() * synonymsData.length)];
        const isSyn = Math.random() > 0.5;
        const typeStr = isSyn ? "è¿‘ä¹‰è¯" : "åä¹‰è¯";
        const answer = isSyn ? item.synonyms : item.antonyms;
        
        synExState.current = { word: item.word, type: typeStr, answer: answer };
        
        document.getElementById('syn-ex-sentence').innerHTML = `è¯·æ‰¾å‡ºçš„â€œ<span class="text-danger fw-bold">${item.word}</span>â€çš„<span class="badge bg-info">${typeStr}</span>ï¼š`;
        
        const optionsDiv = document.getElementById('syn-ex-options');
        optionsDiv.innerHTML = '';
        
        let options = [answer[0]];
        while(options.length < 4) {
            const randomItem = synonymsData[Math.floor(Math.random() * synonymsData.length)];
            const wrongOptions = Math.random() > 0.5 ? randomItem.synonyms : randomItem.antonyms;
            const wrongOpt = wrongOptions[0];
            if(!options.includes(wrongOpt)) options.push(wrongOpt);
        }
        
        options.sort(() => Math.random() - 0.5).forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'exercise-option animate__animated animate__fadeIn';
            btn.innerText = opt;
            btn.onclick = () => checkSynAnswer(opt, btn);
            optionsDiv.appendChild(btn);
        });
        speak(`è¯·é€‰å‡º${item.word}çš„${typeStr}`);
    }
    function checkSynAnswer(selected, btn) {
        if(synExState.current.answer.includes(selected)) {
            btn.classList.add('correct');
            speak(`ç­”å¯¹å•¦ï¼${synExState.current.word}çš„${synExState.current.type}æ˜¯${selected}`);
            updateScore(5);
            setTimeout(nextSynQuestion, 1500);
        } else {
            btn.classList.add('wrong');
            speak("ä¸å¯¹å“¦ï¼Œå†ä»”ç»†æƒ³æƒ³");
            setTimeout(() => btn.classList.remove('wrong'), 1000);
        }
    }

    // --- æˆè¯­æŒ‘æˆ˜é€»è¾‘ ---
    function loadIdiom() {
        const container = document.getElementById('idiom-container');
        container.innerHTML = idiomsData.map((item, i) => `
            <div class="col-md-6">
                <div class="module-card shadow-sm h-100 animate__animated animate__fadeIn" style="border-top: 5px solid #81C784;">
                    <h5 class="fw-bold text-success mb-2">${item.idiom}</h5>
                    <p class="small text-muted mb-2"><strong>è§£é‡Šï¼š</strong>${item.meaning}</p>
                    <p class="small text-secondary mb-0"><strong>ä¾‹å¥ï¼š</strong>${item.example}</p>
                    <button class="btn btn-sm btn-outline-success mt-3 rounded-pill" onclick="speak('${item.idiom}ã€‚${item.meaning}')">ğŸ”Š æœ—è¯»</button>
                </div>
            </div>
        `).join('');
    }

    let idiomExState = { current: null };
    function startIdiomChallenge() {
        document.getElementById('idiom-container').style.display = 'none';
        document.getElementById('idiom-exercise').style.display = 'block';
        nextIdiomQuestion();
    }
    function stopIdiomChallenge() {
        document.getElementById('idiom-container').style.display = 'flex';
        document.getElementById('idiom-exercise').style.display = 'none';
    }
    function nextIdiomQuestion() {
        const item = idiomsData[Math.floor(Math.random() * idiomsData.length)];
        idiomExState.current = item;
        
        document.getElementById('idiom-ex-sentence').innerHTML = `â€œ<span class="text-muted small">${item.meaning}</span>â€<br>å¯¹åº”çš„æˆè¯­æ˜¯ï¼Ÿ`;
        
        const optionsDiv = document.getElementById('idiom-ex-options');
        optionsDiv.innerHTML = '';
        
        let options = [item.idiom];
        while(options.length < 4) {
            const randomItem = idiomsData[Math.floor(Math.random() * idiomsData.length)];
            if(!options.includes(randomItem.idiom)) options.push(randomItem.idiom);
        }
        
        options.sort(() => Math.random() - 0.5).forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'exercise-option animate__animated animate__fadeIn';
            btn.innerText = opt;
            btn.onclick = () => checkIdiomAnswer(opt, btn);
            optionsDiv.appendChild(btn);
        });
        speak("è¯·æ ¹æ®æ„æ€é€‰å‡ºæ­£ç¡®çš„æˆè¯­");
    }
    function checkIdiomAnswer(selected, btn) {
        if(selected === idiomExState.current.idiom) {
            btn.classList.add('correct');
            speak(`å¤ªæ£’äº†ï¼è¿™å°±æ˜¯æˆè¯­${selected}çš„æ„æ€`);
            updateScore(15);
            setTimeout(nextIdiomQuestion, 2000);
        } else {
            btn.classList.add('wrong');
            speak("é€‰é”™å•¦ï¼Œå†è¯»è¯»æˆè¯­æ„æ€å§");
            setTimeout(() => btn.classList.remove('wrong'), 1000);
        }
    }

    function marukoTalk() {
        const lines = ["å®è´ï¼ŒåŠ æ²¹å¤ä¹ å“¦ï¼", "å°ä¸¸å­é™ªç€ä½ ï¼Œè€ƒ 100 åˆ†ï¼", "ä½ æ˜¯æœ€æ£’çš„å°æ‰å¥³ï¼", "è¯­æ–‡å¤ä¹ ä¹Ÿè¦å¼€å¼€å¿ƒå¿ƒï¼"];
        const line = lines[Math.floor(Math.random()*lines.length)];
        speak(line);
        alert("å°ä¸¸å­è¯´ï¼š" + line);
    }
</script>
</body>
</html>
